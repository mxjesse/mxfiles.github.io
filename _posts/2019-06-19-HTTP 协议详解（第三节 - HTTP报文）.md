## HTTP 协议详解（第三节 - HTTP报文）

### 第三节 - HTTP报文
HTTP是因特网的信使，HTTP报文就是信使搬运东西的包裹。

#### 报文流
HTTP报文是HTTP应用程序之间发送的数据块。这些数据块以一些文本形式的元信息（meta-infomation）开头，这些信息描述了报文的内容和含义，后边跟着可选的数据部分。这些报文在客户端、服务器和代理之间流动。术语“流入”、“流出”、“上游”及“下游”都是用来描述报文方向的。

##### 报文流入源端服务器
HTTP使用术语流入（inbound）和流出（outbound）来描述事物处理的方向。HTTP 报文会像河水一样流动。不管是请求报文还是响应报文，所有报文都会向下游（downstream）流动（参见图 3-2）。所有报文的发送者都在接收者的上游（upstream）。

![报文流动](https://raw.githubusercontent.com/mxjesse/mxjesse.github.io/master/img_folder/201906/1560791331333.jpg) 
对请求报文来说，代理 1 位于代理 3 的上游，但对响应报文来说，它就位于代理 3 的下游 1。

##### 报文的组成部分
HTTP报文是简单的格式化数据块。报文由三个部分组成，对报文进行描述的起始行（start line），包含属性的首部（header），以及可选的、包含数据的主体（body）部分。

```
HTTP/1.0 200 OK //起始行
Content-type: text/html //首部
Content-length: 18 //首部

Hi,i'm body part. //主体
```
起始行和首部是由行分隔的ASCII文本。每行都以一个由两个字符组成的行终止序列作为结束（其中一个为回车符ASCII码13，一个为换行符ASCII码10），主体是一个可选的数据块，与起始行和首部不同的是，主体中可以包含文本和二进制数据。

* 请求报文格式

  ```
  <method> <request-URL> <HTTP version>
  <headers>
  
  <entity-body>
  ```
* 响应报文格式

  ```
  <HTTP version> <status> <reason-phrase>
  <headers>
  
  <entity-body>
  ```
  
method方法，request-URL和HTTP version都没什么好说的，headers首部在之后的文章详细说下。
主要说下状态码：
	HTTP状态码被分为五大类，状态码提供了一种客户端理解事物处理结果的便捷方式

1. **100 - 199** - 信息状态码

	状态码 | 原因短语 | 含义
	:---: | :---: | :---:
	100 | Continue | 说明收到了请求的初始部分，请客户端继续
	101 | Switching Protocols | 说明服务器正在根据客户端的指定，将协议切换成Update首部所列的协议

2. **200 - 299** - 成功状态码   
	客户端发起请求时，这些请求通常都是成功的

	状态码 | 原因短语 | 含义
	:---: | :---: | :---:
	200 | OK | 请求成功
	201 | Created | 当服务器依照客户端的请求创建了一个新资源时，发送此响应代码
	202 | Accepted | 请求已被接受，但服务器还未对其执行任何动作。不能保证服务器会完成这个请求；这只是意味着接受请求时，它看起来是有效的
	204 | No Content | 响应报文中包含若干首部和一个状态行，但没有实体的主体部分
	
3. **300 - 399** - 重定向状态码   
	重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么就提供一个替代的响应而不是资源的内容
	
	状态码 | 原因短语 | 含义
	:---: | :---: | :---:
	301 | Moved Permanently | 本网页被永久性转移到另一个URL
	302 | Found | 请求的网页被转移到一个新的地址，但客户访问仍继续通过原始URL地址，重定向，新的URL会在response中的Location中返回，浏览器将会使用新的URL发出新的Request
	304 | Not Modified | 自从上次请求后，请求的网页未修改过，服务器返回此响应时，不会返回网页内容，代表上次的文档已经被缓存了，还可以继续使用

4. **400 - 499** - 客户端错误状态码   
	有时客户端会发送一些服务器无法处理的东西，比如格式错误的请求报文，或者最常见的是，请求一个不存在的 URL。

	状态码 | 原因短语 | 含义
	:---: | :---: | :---:
	400 | Bad Request | 用于告知客户端它发送了一个错误的请求
	401 | Unauthorized | 请求未经授权
	403 | Forbidden | 禁止访问，服务器收到请求，但是拒绝提供服务
	404 | Not Found | 一个404错误表明可连接服务器，但服务器无法取得所请求的网页，请求资源不存在

5. **500 - 599** - 服务器错误状态码   
	有时客户端发送了一条有效请求，服务器自身却出错了。这可能是客户端碰上了服务器的缺陷
	
	状态码 | 原因短语 | 含义
	:---: | :---: | :---:
	500 | Internal Server Error | 服务器遇到错误，无法完成请求
	501 | Not Implemented | 客户端发起的请求超出服务器的能力范围（比如，使用了服务器不支持的请求方法）时，使用此状态码
	503 | Service Unavailable | 由于超载或停机维护，服务器目前无法使用，一段时间后可能恢复正常